<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Essentials · LLVM.jl</title><meta name="title" content="Essentials · LLVM.jl"/><meta property="og:title" content="Essentials · LLVM.jl"/><meta property="twitter:title" content="Essentials · LLVM.jl"/><meta name="description" content="Documentation for LLVM.jl."/><meta property="og:description" content="Documentation for LLVM.jl."/><meta property="twitter:description" content="Documentation for LLVM.jl."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">LLVM.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Usage</span><ul><li class="is-active"><a class="tocitem" href>Essentials</a><ul class="internal"><li><a class="tocitem" href="#Contexts"><span>Contexts</span></a></li><li><a class="tocitem" href="#Memory-management"><span>Memory management</span></a></li></ul></li><li><a class="tocitem" href="../types/">Types</a></li><li><a class="tocitem" href="../values/">Values</a></li><li><a class="tocitem" href="../modules/">Modules</a></li><li><a class="tocitem" href="../functions/">Functions</a></li><li><a class="tocitem" href="../blocks/">Basic blocks</a></li><li><a class="tocitem" href="../instructions/">Instructions</a></li><li><a class="tocitem" href="../metadata/">Metadata</a></li><li><a class="tocitem" href="../analyses/">Analyses</a></li><li><a class="tocitem" href="../transforms/">Transforms</a></li><li><a class="tocitem" href="../codegen/">Code generation</a></li><li><a class="tocitem" href="../execution/">Execution</a></li><li><a class="tocitem" href="../interop/">Julia integration</a></li></ul></li><li><span class="tocitem">API reference</span><ul><li><a class="tocitem" href="../../lib/essentials/">Essentials</a></li><li><a class="tocitem" href="../../lib/types/">Types</a></li><li><a class="tocitem" href="../../lib/values/">Values</a></li><li><a class="tocitem" href="../../lib/modules/">Modules</a></li><li><a class="tocitem" href="../../lib/functions/">Functions</a></li><li><a class="tocitem" href="../../lib/blocks/">Basic blocks</a></li><li><a class="tocitem" href="../../lib/instructions/">Instructions</a></li><li><a class="tocitem" href="../../lib/metadata/">Metadata</a></li><li><a class="tocitem" href="../../lib/analyses/">Analyses</a></li><li><a class="tocitem" href="../../lib/transforms/">Transforms</a></li><li><a class="tocitem" href="../../lib/codegen/">Code generation</a></li><li><a class="tocitem" href="../../lib/execution/">Execution</a></li><li><a class="tocitem" href="../../lib/interop/">Julia integration</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Usage</a></li><li class="is-active"><a href>Essentials</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Essentials</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/maleadt/LLVM.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/maleadt/LLVM.jl/blob/master/docs/src/man/essentials.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Essentials"><a class="docs-heading-anchor" href="#Essentials">Essentials</a><a id="Essentials-1"></a><a class="docs-heading-anchor-permalink" href="#Essentials" title="Permalink"></a></h1><p>After importing LLVM.jl, the packages is ready to use. A simple test to check if the package is working correctly is to query the version of the LLVM library:</p><pre><code class="language-julia-repl hljs">julia&gt; LLVM.version()
v&quot;15.0.7&quot;</code></pre><p>Some back-end functionality may require explicit initialization, for which there are specific functions (replacing <code>*</code> with the back-end name):</p><ul><li><code>LLVM.Initialize*AsmParser</code>: initialize the assembly parser;</li><li><code>LLVM.Initialize*AsmPrinter</code>: initialize the assembly printer;</li><li><code>LLVM.Initialize*Disassembler</code>: initialize the disassembler;</li><li><code>LLVM.Initialize*TargetInfo</code>: initialize the target, allowing inspection;</li><li><code>LLVM.Initialize*Target</code>: initialize the target, allowing use;</li><li><code>LLVM.Initialize*TargetMC</code>: initialize the target machine code generation.</li></ul><p>These functions are only available for the back-ends that are enabled in the LLVM library:</p><pre><code class="language-julia-repl hljs">julia&gt; LLVM.backends()
4-element Vector{Symbol}:
 :AArch64
 :AVR
 :BPF
 :WebAssembly</code></pre><p>Special versions of these functions are available to initialize all available targets, e.g., <code>LLVM.InitializeAllTargetInfos</code>, or to initialize the native target, e.g., <code>LLVM.InitializeNativeTarget</code>.</p><h2 id="Contexts"><a class="docs-heading-anchor" href="#Contexts">Contexts</a><a id="Contexts-1"></a><a class="docs-heading-anchor-permalink" href="#Contexts" title="Permalink"></a></h2><p>Most operations in LLVM require a context to be active. In LLVM.jl, LLVM contexts are available as <code>Context</code> objects, and you are expected to create a context before creating any other LLVM objects.</p><p>To create a new LLVM context, use the <code>Context()</code> constructor:</p><pre><code class="language-julia-repl hljs">julia&gt; ctx = Context()
LLVM.Context(0x0000600003d18980, typed ptrs)

julia&gt; dispose(ctx) # see next section</code></pre><p>Although many LLVM APIs expect a context as an argument, LLVM.jl automatically manages the context in the task-local state. The current task-local context is accessible via the <code>context()</code> function, and is automatically used by most LLVM.jl functions when an API requires an LLVM context. To populate the task-local context, it is sufficient to create a new context object:</p><pre><code class="language-julia-repl hljs">julia&gt; context()
ERROR: No LLVM context is active

julia&gt; ctx = Context();

julia&gt; context()
LLVM.Context(0x0000600000ae1470, typed ptrs)</code></pre><p>Although the context is automatically managed by LLVM.jl, it is still important to keep track of the context object for proper disposal after use. This also wipes the task-local context:</p><pre><code class="language-julia-repl hljs">julia&gt; ctx = Context()
LLVM.Context(0x000060000007c4b0, typed ptrs)

julia&gt; dispose(ctx)

julia&gt; context()
ERROR: No LLVM context is active</code></pre><h2 id="Memory-management"><a class="docs-heading-anchor" href="#Memory-management">Memory management</a><a id="Memory-management-1"></a><a class="docs-heading-anchor-permalink" href="#Memory-management" title="Permalink"></a></h2><p>LLVM.jl does not use automatic memory management for LLVM objects<sup class="footnote-reference"><a id="citeref-1" href="#footnote-1">[1]</a></sup>, and instead relies on manual disposal of resources by calling the <code>dispose</code> method. For example, to create and dispose of a module object:</p><pre><code class="language-julia-repl hljs">julia&gt; mod = LLVM.Module(&quot;MyModule&quot;);

julia&gt; dispose(mod)</code></pre><p>After calling <code>dispose</code>, the object is no longer valid and should not be used. Doing so will often result in hard crashes:</p><pre><code class="language-julia-repl hljs">julia&gt; mod
[94707] signal (11.2): Segmentation fault: 11</code></pre><h3 id="Scoped-disposal"><a class="docs-heading-anchor" href="#Scoped-disposal">Scoped disposal</a><a id="Scoped-disposal-1"></a><a class="docs-heading-anchor-permalink" href="#Scoped-disposal" title="Permalink"></a></h3><p>For convenience, many of these objects can be created and disposed using do-block variants of their constructors. This makes it harder to use the object outside of its lifetime, and also handles exceptions that might occur during the object&#39;s construction:</p><pre><code class="language-julia-repl hljs">julia&gt; LLVM.Module(&quot;MyModule&quot;) do mod
         # use mod
       end</code></pre><p>This pattern is useful, but can become cumbersome when working with multiple objects that need to be disposed of. In addition, the function closures constructed here can have an impact on performance. To address these issues, LLVM.jl provides a <a href="../../lib/essentials/#LLVM.@dispose"><code>@dispose</code></a> macro that conveniently disposes of multiple objects at once:</p><pre><code class="language-julia-repl hljs">julia&gt; @dispose ctx=Context() mod=LLVM.Module(&quot;jit&quot;) begin
         # mod and ctx are automatically disposed of after this block
       end</code></pre><p>It is recommended to use the <a href="../../lib/essentials/#LLVM.@dispose"><code>@dispose</code></a> macro whenever possible.</p><h3 id="Debugging-missing-disposals"><a class="docs-heading-anchor" href="#Debugging-missing-disposals">Debugging missing disposals</a><a id="Debugging-missing-disposals-1"></a><a class="docs-heading-anchor-permalink" href="#Debugging-missing-disposals" title="Permalink"></a></h3><p>To ensure that all resources are properly disposed of, LLVM.jl provides functionality to track the creation and disposal of objects. This can be enabled by setting the <code>memcheck</code> preference in <code>LocalPreferences</code> to <code>true</code>.</p><p>When enabled, LLVM.jl will warn when using an object after it has been disposed of:</p><pre><code class="language-julia-repl hljs">julia&gt; ctx = Context();

julia&gt; dispose(ctx)

julia&gt; ctx
WARNING: An instance of Context is being used after it was disposed.</code></pre><p>The package will also warn about erroneous disposals, whether it&#39;s disposing an unknown object, or disposing an object that has already been disposed of:</p><pre><code class="language-julia-repl hljs">julia&gt; buf = MemoryBuffer(UInt8[]);

julia&gt; dispose(buf)
julia&gt; dispose(buf)
WARNING: An instance of MemoryBuffer is being disposed twice.</code></pre><pre><code class="language-julia-repl hljs">julia&gt; dispose(MemoryBuffer(LLVM.API.LLVMMemoryBufferRef(1)))
WARNING: An unknown instance of MemoryBuffer is being disposed of.</code></pre><p>Finally, when not properly disposing of an object, LLVM.jl will warn about the leaked object when the process exits:</p><pre><code class="language-julia-repl hljs">julia&gt; ctx = Context();

julia&gt; exit()
WARNING: An instance of Context was not properly disposed of.</code></pre><section class="footnotes is-size-7"><ul><li class="footnote" id="footnote-1"><a class="tag is-link" href="#citeref-1">1</a>See <a href="https://github.com/maleadt/LLVM.jl/pull/309">this issue</a> for more details.</li></ul></section></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../">« Home</a><a class="docs-footer-nextpage" href="../types/">Types »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.7.0 on <span class="colophon-date" title="Friday 20 December 2024 09:33">Friday 20 December 2024</span>. Using Julia version 1.11.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
